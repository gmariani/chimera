!function(e){function n(r){if(o[r])return o[r].exports;var s=o[r]={i:r,l:!1,exports:{}};return e[r].call(s.exports,s,s.exports,n),s.l=!0,s.exports}var o={};n.m=e,n.c=o,n.d=function(e,o,r){n.o(e,o)||Object.defineProperty(e,o,{configurable:!1,enumerable:!0,get:r})},n.n=function(e){var o=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(o,"a",o),o},n.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},n.p="",n(n.s=0)}([function(e,n,o){"use strict";Object.defineProperty(n,"__esModule",{value:!0});var r=o(1),s=o(2),t={},i=!0;!function(){var e;t.getOS=function(){if(!e){var n=[{s:"Windows 3.11",r:/Win16/,short:"Win"},{s:"Windows 95",r:/(Windows 95|Win95|Windows_95)/,short:"Win"},{s:"Windows ME",r:/(Win 9x 4.90|Windows ME)/,short:"Win"},{s:"Windows 98",r:/(Windows 98|Win98)/,short:"Win"},{s:"Windows CE",r:/Windows CE/,short:"Win"},{s:"Windows 2000",r:/(Windows NT 5.0|Windows 2000)/,short:"Win"},{s:"Windows XP",r:/(Windows NT 5.1|Windows XP)/,short:"Win"},{s:"Windows Server 2003",r:/Windows NT 5.2/,short:"Win"},{s:"Windows Vista",r:/Windows NT 6.0/,short:"Win"},{s:"Windows 7",r:/(Windows 7|Windows NT 6.1)/,short:"Win"},{s:"Windows 8.1",r:/(Windows 8.1|Windows NT 6.3)/,short:"Win"},{s:"Windows 8",r:/(Windows 8|Windows NT 6.2)/,short:"Win"},{s:"Windows NT 4.0",r:/(Windows NT 4.0|WinNT4.0|WinNT|Windows NT)/,short:"Win"},{s:"Windows ME",r:/Windows ME/,short:"Win"},{s:"Linux",r:/(Linux|X11)/,short:"Linux"},{s:"Mac OS X",r:/Mac OS X/,short:"Mac"},{s:"Mac OS",r:/(MacPPC|MacIntel|Mac_PowerPC|Macintosh)/,short:"Mac"},{s:"UNIX",r:/UNIX/,short:"Unix"}];for(var o in n){var r=n[o];if(r.r.test(navigator.userAgent)){e=r;break}}}return e}}(),Object(r.b)(function(){function e(e){if(e.lengthComputable){var n=Math.round(e.loaded/e.total*100);n<100&&(g.style.width=n+"%",g.textContent=n+"%")}}function n(e){var n=e.target.error;switch(n.code){case n.NOT_FOUND_ERR:console.error("File Not Found!");break;case n.NOT_READABLE_ERR:console.error("File is not readable!");break;case n.ABORT_ERR:break;default:console.error("An error occurred reading this file.<code>"+n.message+"<br>("+n.filename+":"+n.lineno+")</code>")}}function o(e,n){alert("done!"),console.log(e,n)}function t(e,n,o,r){var s=new Worker("js/workers/"+e+".js");s.onmessage=function(e){if("debug"!=e.data.type)if("warning"!=e.data.type)if("alert"!=e.data.type){var n=e.data.data;n.fileSize=o.size,n.fileName=o.name,i&&console.log("Data",n);var s=JSON.stringify(n);r(s,o)}else i&&console.warn(e.data.message);else i&&console.warn(e.data.message);else i&&console.info(e.data.message)},s.onerror=function(e){console.error("Worker "+e.message+"  ("+e.filename+":"+e.lineno+")"),r({text:"Error reading file",icon:"error"},o)},s.postMessage({text:n,fileID:0})}var a,c,d,l=!1,u=[],f="";window.JSON||(f+="<li>JSON API - Used to pass data</li>",l=!0),window.FileReader||(f+="<li>FileReader API - Used to read user files</li>",l=!0),window.Worker||(f+="<li>JavaScript Workers - Used to process files</li>",l=!0),f+="</ul><p>Please upgrade your browser in order to use <strong>.chimera</strong>.</p>",l&&u.push("<p>It appears your browser does not support:</p><ul>"+f),u.length>0&&console.error(u.join("<hr/>"));var w=Object(r.a)("#btnFileCancel"),W=Object(r.a)("#fileProgressBar"),g=Object(r.a)("#fileProgressBar div");Object(r.a)("#filesFile").addEventListener("change",function(r){var l=r.target.files;if(l.length){Object(s.a)(w,"show");var u=(d=l[0]).name.toLowerCase().slice(-3);switch(i&&console.log("File: ",d),u){case"jpg":case"jpeg":c="JPG";break;case"swf":c="SWF";break;default:return void console.error("Invalid file type!")}(a=new FileReader).onerror=n,a.onprogress=e,a.onabort=function(){console.info("File read cancelled.")},a.onloadstart=function(){g.style.width="0%",g.textContent="0%",Object(s.a)(W,"loading")},a.onloadend=function(){g.style.width="100%",g.textContent="100%",setTimeout(function(){Object(s.b)(W,"loading"),Object(s.b)(w,"show")},250)},a.onload=function(e){t(c,e.target.result,d,o)},a.readAsArrayBuffer(d)}else console.warn("Please select a file first!")}),w.addEventListener("click",function(){a&&a.abort()})})},function(e,n,o){"use strict";o.d(n,"a",function(){return r}),o.d(n,"b",function(){return s});const r=(e,n=document)=>{const o=n.querySelectorAll(e);return 1===o.length?o[0]:o},s=(e,n=document)=>{"loading"!==n.readyState?e():n.addEventListener("DOMContentLoaded",e)}},function(e,n,o){"use strict";o.d(n,"a",function(){return r}),o.d(n,"b",function(){return s});const r=(e,n)=>(e.classList?e.classList.add(n):e.className+=" "+n,e),s=(e,n)=>(e.classList?e.classList.remove(n):e.className=e.className.replace(new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi")," "),e)}]);
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIndlYnBhY2s6Ly8vd2VicGFjay9ib290c3RyYXAgOWMwZWQ3NjU5ZmEzNjEzZTY4ODgiLCJ3ZWJwYWNrOi8vLy4vc3JjL21haW4uanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2pzL21vZHVsZXMvdG9vbGJveC1jb21tb24uanMiLCJ3ZWJwYWNrOi8vLy4vc3JjL2pzL21vZHVsZXMvdG9vbGJveC1jc3MuanMiXSwibmFtZXMiOlsiX193ZWJwYWNrX3JlcXVpcmVfXyIsIm1vZHVsZUlkIiwiaW5zdGFsbGVkTW9kdWxlcyIsImV4cG9ydHMiLCJtb2R1bGUiLCJpIiwibCIsIm1vZHVsZXMiLCJjYWxsIiwibSIsImMiLCJkIiwibmFtZSIsImdldHRlciIsIm8iLCJPYmplY3QiLCJkZWZpbmVQcm9wZXJ0eSIsImNvbmZpZ3VyYWJsZSIsImVudW1lcmFibGUiLCJnZXQiLCJuIiwiX19lc01vZHVsZSIsIm9iamVjdCIsInByb3BlcnR5IiwicHJvdG90eXBlIiwiaGFzT3duUHJvcGVydHkiLCJwIiwicyIsInV0aWwiLCJkZWJ1ZyIsIm9zIiwiZ2V0T1MiLCJjbGllbnRTdHJpbmdzIiwiciIsInNob3J0IiwiaWQiLCJjcyIsInRlc3QiLCJuYXZpZ2F0b3IiLCJ1c2VyQWdlbnQiLCJfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzBfX2pzX21vZHVsZXNfdG9vbGJveF9jb21tb25fXyIsInVwZGF0ZVByb2dyZXNzIiwiZSIsImxlbmd0aENvbXB1dGFibGUiLCJwZXJjZW50TG9hZGVkIiwiTWF0aCIsInJvdW5kIiwibG9hZGVkIiwidG90YWwiLCJkaXZQcm9ncmVzcyIsInN0eWxlIiwid2lkdGgiLCJ0ZXh0Q29udGVudCIsImVycm9ySGFuZGxlciIsImVyciIsInRhcmdldCIsImVycm9yIiwiY29kZSIsIk5PVF9GT1VORF9FUlIiLCJjb25zb2xlIiwiTk9UX1JFQURBQkxFX0VSUiIsIkFCT1JUX0VSUiIsIm1lc3NhZ2UiLCJmaWxlbmFtZSIsImxpbmVubyIsInVwZGF0ZURpc3BsYXkiLCJqc29uIiwiZmlsZSIsImFsZXJ0IiwibG9nIiwiY3JlYXRlV29ya2VyIiwicGFyc2VyIiwiYnVmZmVyIiwib25Db21wbGV0ZSIsIndvcmtlciIsIldvcmtlciIsIm9ubWVzc2FnZSIsImRhdGEiLCJ0eXBlIiwiZmlsZVNpemUiLCJzaXplIiwiZmlsZU5hbWUiLCJKU09OIiwic3RyaW5naWZ5Iiwid2FybiIsImluZm8iLCJvbmVycm9yIiwidGV4dCIsImljb24iLCJwb3N0TWVzc2FnZSIsImZpbGVJRCIsInJlYWRlciIsImlzc3VlcyIsIm1zZ19hcnJheSIsIm1zZ19lcnJvciIsIndpbmRvdyIsIkZpbGVSZWFkZXIiLCJwdXNoIiwibGVuZ3RoIiwiam9pbiIsImJ0bkNhbmNlbEZpbGUiLCJlbFByb2dyZXNzQmFyIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2ZW50IiwiZmlsZXMiLCJfX1dFQlBBQ0tfSU1QT1JURURfTU9EVUxFXzFfX2pzX21vZHVsZXNfdG9vbGJveF9jc3NfXyIsImV4dCIsInRvTG93ZXJDYXNlIiwic2xpY2UiLCJvbnByb2dyZXNzIiwib25hYm9ydCIsIm9ubG9hZHN0YXJ0Iiwib25sb2FkZW5kIiwic2V0VGltZW91dCIsIm9ubG9hZCIsInJlc3VsdCIsInJlYWRBc0FycmF5QnVmZmVyIiwiYWJvcnQiLCIkIiwic2VsZWN0b3JzIiwiZG9jIiwiZG9jdW1lbnQiLCJxdWVyeVNlbGVjdG9yQWxsIiwicmVhZHkiLCJmdW5jIiwicmVhZHlTdGF0ZSIsIl9fd2VicGFja19leHBvcnRzX18iLCJyZW1vdmVDbGFzcyIsImFkZENsYXNzIiwiZWwiLCJzdHJDbGFzcyIsImNsYXNzTGlzdCIsImFkZCIsImNsYXNzTmFtZSIsInJlbW92ZSIsInJlcGxhY2UiLCJSZWdFeHAiLCJzcGxpdCJdLCJtYXBwaW5ncyI6ImFBSUEsU0FBQUEsRUFBQUMsR0FHQSxHQUFBQyxFQUFBRCxHQUNBLE9BQUFDLEVBQUFELEdBQUFFLFFBR0EsSUFBQUMsRUFBQUYsRUFBQUQsSUFDQUksRUFBQUosRUFDQUssR0FB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QyxFQUFBLENBQUFDLEVBQUFDLEVBQUFDLFlBQ0EsTUFBQU4sRUFBQUssRUFBQUUsaUJBQUFILEdBQ0EsV0FBQUosRUFBQWpCLE9BQUFpQixFQUFBLEdBQUFBLEdBR0FRLEVBQUEsQ0FBQUMsRUFBQUosRUFBQUMsWUFDQSxZQUFBRCxFQUFBSyxXQUNBRCxJQUVBSixFQUFBbEIsaUJBQUEsbUJBQUFzQixrRUNUQTVILEVBQUFXLEVBQUFtSCxFQUFBLHNCQUFBQyxJQUFBLE1BOEZBQyxFQUFBLENBQUFDLEVBQUFDLEtBQ0FELEVBQUFFLFVBQ0FGLEVBQUFFLFVBQUFDLElBQUFGLEdBRUFELEVBQUFJLFdBQUEsSUFBQUgsRUFFQUQsR0FHQUYsRUFBQSxDQUFBRSxFQUFBQyxLQUNBRCxFQUFBRSxVQUNBRixFQUFBRSxVQUFBRyxPQUFBSixHQUVBRCxFQUFBSSxVQUFBSixFQUFBSSxVQUFBRSxRQUFBLElBQUFDLE9BQUEsVUFBQU4sRUFBQU8sTUFBQSxLQUFBdEMsS0FBQSwwQkFFQThCIiwiZmlsZSI6Im1haW4uYnVuZGxlLmpzIiwic291cmNlc0NvbnRlbnQiOlsiIFx0Ly8gVGhlIG1vZHVsZSBjYWNoZVxuIFx0dmFyIGluc3RhbGxlZE1vZHVsZXMgPSB7fTtcblxuIFx0Ly8gVGhlIHJlcXVpcmUgZnVuY3Rpb25cbiBcdGZ1bmN0aW9uIF9fd2VicGFja19yZXF1aXJlX18obW9kdWxlSWQpIHtcblxuIFx0XHQvLyBDaGVjayBpZiBtb2R1bGUgaXMgaW4gY2FjaGVcbiBcdFx0aWYoaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0pIHtcbiBcdFx0XHRyZXR1cm4gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0uZXhwb3J0cztcbiBcdFx0fVxuIFx0XHQvLyBDcmVhdGUgYSBuZXcgbW9kdWxlIChhbmQgcHV0IGl0IGludG8gdGhlIGNhY2hlKVxuIFx0XHR2YXIgbW9kdWxlID0gaW5zdGFsbGVkTW9kdWxlc1ttb2R1bGVJZF0gPSB7XG4gXHRcdFx0aTogbW9kdWxlSWQsXG4gXHRcdFx0bDogZmFsc2UsXG4gXHRcdFx0ZXhwb3J0czoge31cbiBcdFx0fTtcblxuIFx0XHQvLyBFeGVjdXRlIHRoZSBtb2R1bGUgZnVuY3Rpb25cbiBcdFx0bW9kdWxlc1ttb2R1bGVJZF0uY2FsbChtb2R1bGUuZXhwb3J0cywgbW9kdWxlLCBtb2R1bGUuZXhwb3J0cywgX193ZWJwYWNrX3JlcXVpcmVfXyk7XG5cbiBcdFx0Ly8gRmxhZyB0aGUgbW9kdWxlIGFzIGxvYWRlZFxuIFx0XHRtb2R1bGUubCA9IHRydWU7XG5cbiBcdFx0Ly8gUmV0dXJuIHRoZSBleHBvcnRzIG9mIHRoZSBtb2R1bGVcbiBcdFx0cmV0dXJuIG1vZHVsZS5leHBvcnRzO1xuIFx0fVxuXG5cbiBcdC8vIGV4cG9zZSB0aGUgbW9kdWxlcyBvYmplY3QgKF9fd2VicGFja19tb2R1bGVzX18pXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm0gPSBtb2R1bGVzO1xuXG4gXHQvLyBleHBvc2UgdGhlIG1vZHVsZSBjYWNoZVxuIFx0X193ZWJwYWNrX3JlcXVpcmVfXy5jID0gaW5zdGFsbGVkTW9kdWxlcztcblxuIFx0Ly8gZGVmaW5lIGdldHRlciBmdW5jdGlvbiBmb3IgaGFybW9ueSBleHBvcnRzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQgPSBmdW5jdGlvbihleHBvcnRzLCBuYW1lLCBnZXR0ZXIpIHtcbiBcdFx0aWYoIV9fd2VicGFja19yZXF1aXJlX18ubyhleHBvcnRzLCBuYW1lKSkge1xuIFx0XHRcdE9iamVjdC5kZWZpbmVQcm9wZXJ0eShleHBvcnRzLCBuYW1lLCB7XG4gXHRcdFx0XHRjb25maWd1cmFibGU6IGZhbHNlLFxuIFx0XHRcdFx0ZW51bWVyYWJsZTogdHJ1ZSxcbiBcdFx0XHRcdGdldDogZ2V0dGVyXG4gXHRcdFx0fSk7XG4gXHRcdH1cbiBcdH07XG5cbiBcdC8vIGdldERlZmF1bHRFeHBvcnQgZnVuY3Rpb24gZm9yIGNvbXBhdGliaWxpdHkgd2l0aCBub24taGFybW9ueSBtb2R1bGVzXG4gXHRfX3dlYnBhY2tfcmVxdWlyZV9fLm4gPSBmdW5jdGlvbihtb2R1bGUpIHtcbiBcdFx0dmFyIGdldHRlciA9IG1vZHVsZSAmJiBtb2R1bGUuX19lc01vZHVsZSA/XG4gXHRcdFx0ZnVuY3Rpb24gZ2V0RGVmYXVsdCgpIHsgcmV0dXJuIG1vZHVsZVsnZGVmYXVsdCddOyB9IDpcbiBcdFx0XHRmdW5jdGlvbiBnZXRNb2R1bGVFeHBvcnRzKCkgeyByZXR1cm4gbW9kdWxlOyB9O1xuIFx0XHRfX3dlYnBhY2tfcmVxdWlyZV9fLmQoZ2V0dGVyLCAnYScsIGdldHRlcik7XG4gXHRcdHJldHVybiBnZXR0ZXI7XG4gXHR9O1xuXG4gXHQvLyBPYmplY3QucHJvdG90eXBlLmhhc093blByb3BlcnR5LmNhbGxcbiBcdF9fd2VicGFja19yZXF1aXJlX18ubyA9IGZ1bmN0aW9uKG9iamVjdCwgcHJvcGVydHkpIHsgcmV0dXJuIE9iamVjdC5wcm90b3R5cGUuaGFzT3duUHJvcGVydHkuY2FsbChvYmplY3QsIHByb3BlcnR5KTsgfTtcblxuIFx0Ly8gX193ZWJwYWNrX3B1YmxpY19wYXRoX19cbiBcdF9fd2VicGFja19yZXF1aXJlX18ucCA9IFwiXCI7XG5cbiBcdC8vIExvYWQgZW50cnkgbW9kdWxlIGFuZCByZXR1cm4gZXhwb3J0c1xuIFx0cmV0dXJuIF9fd2VicGFja19yZXF1aXJlX18oX193ZWJwYWNrX3JlcXVpcmVfXy5zID0gMCk7XG5cblxuXG4vLyBXRUJQQUNLIEZPT1RFUiAvL1xuLy8gd2VicGFjay9ib290c3RyYXAgOWMwZWQ3NjU5ZmEzNjEzZTY4ODgiLCJpbXBvcnQge3JlYWR5LCAkfSBmcm9tICcuL2pzL21vZHVsZXMvdG9vbGJveC1jb21tb24nO1xyXG5pbXBvcnQge2FkZENsYXNzLCByZW1vdmVDbGFzc30gZnJvbSAnLi9qcy9tb2R1bGVzL3Rvb2xib3gtY3NzJztcclxuXHJcbnZhciB1dGlsID0ge307XHJcbnZhciBkZWJ1ZyA9IHRydWU7XHJcbihmdW5jdGlvbigpIHtcclxuICAgIHZhciBvcztcclxuICAgIHV0aWwuZ2V0T1MgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICBpZiAoIW9zKSB7XHJcbiAgICAgICAgICAgIHZhciBjbGllbnRTdHJpbmdzID0gW1xyXG4gICAgICAgICAgICAgICAge3M6J1dpbmRvd3MgMy4xMScsIHI6L1dpbjE2Lywgc2hvcnQ6J1dpbid9LFxyXG4gICAgICAgICAgICAgICAge3M6J1dpbmRvd3MgOTUnLCByOi8oV2luZG93cyA5NXxXaW45NXxXaW5kb3dzXzk1KS8sIHNob3J0OidXaW4nfSxcclxuICAgICAgICAgICAgICAgIHtzOidXaW5kb3dzIE1FJywgcjovKFdpbiA5eCA0LjkwfFdpbmRvd3MgTUUpLywgc2hvcnQ6J1dpbid9LFxyXG4gICAgICAgICAgICAgICAge3M6J1dpbmRvd3MgOTgnLCByOi8oV2luZG93cyA5OHxXaW45OCkvLCBzaG9ydDonV2luJ30sXHJcbiAgICAgICAgICAgICAgICB7czonV2luZG93cyBDRScsIHI6L1dpbmRvd3MgQ0UvLCBzaG9ydDonV2luJ30sXHJcbiAgICAgICAgICAgICAgICB7czonV2luZG93cyAyMDAwJywgcjovKFdpbmRvd3MgTlQgNS4wfFdpbmRvd3MgMjAwMCkvLCBzaG9ydDonV2luJ30sXHJcbiAgICAgICAgICAgICAgICB7czonV2luZG93cyBYUCcsIHI6LyhXaW5kb3dzIE5UIDUuMXxXaW5kb3dzIFhQKS8sIHNob3J0OidXaW4nfSxcclxuICAgICAgICAgICAgICAgIHtzOidXaW5kb3dzIFNlcnZlciAyMDAzJywgcjovV2luZG93cyBOVCA1LjIvLCBzaG9ydDonV2luJ30sXHJcbiAgICAgICAgICAgICAgICB7czonV2luZG93cyBWaXN0YScsIHI6L1dpbmRvd3MgTlQgNi4wLywgc2hvcnQ6J1dpbid9LFxyXG4gICAgICAgICAgICAgICAge3M6J1dpbmRvd3MgNycsIHI6LyhXaW5kb3dzIDd8V2luZG93cyBOVCA2LjEpLywgc2hvcnQ6J1dpbid9LFxyXG4gICAgICAgICAgICAgICAge3M6J1dpbmRvd3MgOC4xJywgcjovKFdpbmRvd3MgOC4xfFdpbmRvd3MgTlQgNi4zKS8sIHNob3J0OidXaW4nfSxcclxuICAgICAgICAgICAgICAgIHtzOidXaW5kb3dzIDgnLCByOi8oV2luZG93cyA4fFdpbmRvd3MgTlQgNi4yKS8sIHNob3J0OidXaW4nfSxcclxuICAgICAgICAgICAgICAgIHtzOidXaW5kb3dzIE5UIDQuMCcsIHI6LyhXaW5kb3dzIE5UIDQuMHxXaW5OVDQuMHxXaW5OVHxXaW5kb3dzIE5UKS8sIHNob3J0OidXaW4nfSxcclxuICAgICAgICAgICAgICAgIHtzOidXaW5kb3dzIE1FJywgcjovV2luZG93cyBNRS8sIHNob3J0OidXaW4nfSxcclxuICAgICAgICAgICAgICAgIC8ve3M6J0FuZHJvaWQnLCByOi9BbmRyb2lkLywgc2hvcnQ6J0FuZHJvaWQnfSxcclxuICAgICAgICAgICAgICAgIHtzOidMaW51eCcsIHI6LyhMaW51eHxYMTEpLywgc2hvcnQ6J0xpbnV4J30sXHJcbiAgICAgICAgICAgICAgICAvL3tzOidpT1MnLCByOi8oaVBob25lfGlQYWR8aVBvZCkvLCBzaG9ydDonaU9TJ30sXHJcbiAgICAgICAgICAgICAgICB7czonTWFjIE9TIFgnLCByOi9NYWMgT1MgWC8sIHNob3J0OidNYWMnfSxcclxuICAgICAgICAgICAgICAgIHtzOidNYWMgT1MnLCByOi8oTWFjUFBDfE1hY0ludGVsfE1hY19Qb3dlclBDfE1hY2ludG9zaCkvLCBzaG9ydDonTWFjJ30sXHJcbiAgICAgICAgICAgICAgICB7czonVU5JWCcsIHI6L1VOSVgvLCBzaG9ydDonVW5peCd9LFxyXG4gICAgICAgICAgICBdO1xyXG4gICAgICAgICAgICBcclxuICAgICAgICAgICAgZm9yICh2YXIgaWQgaW4gY2xpZW50U3RyaW5ncykge1xyXG4gICAgICAgICAgICAgICAgdmFyIGNzID0gY2xpZW50U3RyaW5nc1tpZF07XHJcbiAgICAgICAgICAgICAgICBpZiAoY3Muci50ZXN0KG5hdmlnYXRvci51c2VyQWdlbnQpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgb3MgPSBjcztcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICBcclxuICAgICAgICByZXR1cm4gb3M7XHJcbiAgICB9O1xyXG59KSgpO1xyXG5cclxucmVhZHkoZnVuY3Rpb24gKCkge1xyXG5cclxuICAgIHZhciByZWFkZXI7XHJcbiAgICB2YXIgcGFyc2VyO1xyXG4gICAgdmFyIGZpbGU7XHJcblxyXG4gICAgLy8vLy8vLy8vLy8vLy8vLy8vLy9cclxuICAgIC8vIEluaXRpYWxpemF0aW9uIC8vXHJcbiAgICAvLy8vLy8vLy8vLy8vLy8vLy8vL1xyXG4gICAgXHJcbiAgICAvLyBTaG93IGFueSBpbmNvbXBhdGliaWxpdGllc1xyXG4gICAgdmFyIGlzc3VlcyA9IGZhbHNlO1xyXG4gICAgdmFyIG1zZ19hcnJheSA9IFtdO1xyXG4gICAgXHJcbiAgICB2YXIgbXNnX2Vycm9yX3ByZWZpeCA9ICc8cD5JdCBhcHBlYXJzIHlvdXIgYnJvd3NlciBkb2VzIG5vdCBzdXBwb3J0OjwvcD48dWw+JztcclxuICAgIHZhciBtc2dfZXJyb3IgPSAnJztcclxuICAgIGlmICghd2luZG93LkpTT04pIHtcclxuICAgICAgICBtc2dfZXJyb3IgKz0gJzxsaT5KU09OIEFQSSAtIFVzZWQgdG8gcGFzcyBkYXRhPC9saT4nO1xyXG4gICAgICAgIGlzc3VlcyA9IHRydWU7XHJcbiAgICB9XHJcbiAgICBpZiAoIXdpbmRvdy5GaWxlUmVhZGVyKSB7XHJcbiAgICAgICAgbXNnX2Vycm9yICs9ICc8bGk+RmlsZVJlYWRlciBBUEkgLSBVc2VkIHRvIHJlYWQgdXNlciBmaWxlczwvbGk+JztcclxuICAgICAgICBpc3N1ZXMgPSB0cnVlO1xyXG4gICAgfVxyXG4gICAgXHJcbiAgICBpZiAoIXdpbmRvdy5Xb3JrZXIpIHtcclxuICAgICAgICBtc2dfZXJyb3IgKz0gJzxsaT5KYXZhU2NyaXB0IFdvcmtlcnMgLSBVc2VkIHRvIHByb2Nlc3MgZmlsZXM8L2xpPic7XHJcbiAgICAgICAgaXNzdWVzID0gdHJ1ZTtcclxuICAgIH1cclxuICAgIG1zZ19lcnJvciArPSAnPC91bD48cD5QbGVhc2UgdXBncmFkZSB5b3VyIGJyb3dzZXIgaW4gb3JkZXIgdG8gdXNlIDxzdHJvbmc+LmNoaW1lcmE8L3N0cm9uZz4uPC9wPic7XHJcbiAgICBpZiAoaXNzdWVzKSBtc2dfYXJyYXkucHVzaChtc2dfZXJyb3JfcHJlZml4ICsgbXNnX2Vycm9yKTtcclxuICAgIFxyXG4gICAgaWYgKG1zZ19hcnJheS5sZW5ndGggPiAwKSBjb25zb2xlLmVycm9yKG1zZ19hcnJheS5qb2luKCc8aHIvPicpKTtcclxuICAgIFxyXG4gICAgXHJcbiAgICAvLy8vLy8vLy8vLy9cclxuICAgIC8vIE1vZGFscyAvL1xyXG4gICAgLy8vLy8vLy8vLy8vXHJcbiAgICB2YXIgYnRuQ2FuY2VsRmlsZSA9ICQoJyNidG5GaWxlQ2FuY2VsJyk7XHJcbiAgICB2YXIgZWxQcm9ncmVzc0JhciA9ICQoJyNmaWxlUHJvZ3Jlc3NCYXInKTtcclxuICAgIHZhciBkaXZQcm9ncmVzcyA9ICQoJyNmaWxlUHJvZ3Jlc3NCYXIgZGl2Jyk7XHJcbiAgICBcclxuICAgICQoJyNmaWxlc0ZpbGUnKS5hZGRFdmVudExpc3RlbmVyKCdjaGFuZ2UnLCBmdW5jdGlvbihldmVudCkge1xyXG4gICAgICAgIHZhciBmaWxlcyA9IGV2ZW50LnRhcmdldC5maWxlczsgLy8gRmlsZUxpc3Qgb2JqZWN0XHJcblxyXG4gICAgICAgIGlmICghZmlsZXMubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUud2FybignUGxlYXNlIHNlbGVjdCBhIGZpbGUgZmlyc3QhJyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gU2hvdyBjYW5jZWwgd2hpbGUgcmVhZGluZ1xyXG4gICAgICAgIGFkZENsYXNzKGJ0bkNhbmNlbEZpbGUsICdzaG93Jyk7XHJcbiAgICBcclxuICAgICAgICAvLyBSZXNldCBmb3IgbmV3IGZpbGVcclxuICAgICAgICAvL2Nsb3NlRmlsZSgpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGZpbGUgPSBmaWxlc1swXTsgLy8gUmVhZCBvbmx5IGZpcnN0IGZpbGVcclxuICAgICAgICB2YXIgZXh0ID0gZmlsZS5uYW1lLnRvTG93ZXJDYXNlKCkuc2xpY2UoLTMpO1xyXG4gICAgICAgIGlmIChkZWJ1ZykgY29uc29sZS5sb2coJ0ZpbGU6ICcsIGZpbGUpO1xyXG5cclxuICAgICAgICAvLyBEZXRlcm1pbmUgZmlsZSB0eXBlXHJcbiAgICAgICAgc3dpdGNoIChleHQpIHtcclxuICAgICAgICAgICAgY2FzZSAnanBnJyA6XHJcbiAgICAgICAgICAgIGNhc2UgJ2pwZWcnIDpcclxuICAgICAgICAgICAgICAgIHBhcnNlciA9ICdKUEcnO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgJ3N3ZicgOlxyXG4gICAgICAgICAgICAgICAgcGFyc2VyID0gJ1NXRic7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgZGVmYXVsdCA6XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdJbnZhbGlkIGZpbGUgdHlwZSEnKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgLy8gVGl0bGUgYmVmb3JlIHBhcnNpbmdcclxuICAgICAgICAvL3VwZGF0ZVNpZGViYXIobnVsbCwgZmlsZSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgcmVhZGVyID0gbmV3IEZpbGVSZWFkZXIoKTtcclxuICAgICAgICByZWFkZXIub25lcnJvciA9IGVycm9ySGFuZGxlcjtcclxuICAgICAgICByZWFkZXIub25wcm9ncmVzcyA9IHVwZGF0ZVByb2dyZXNzO1xyXG4gICAgICAgIHJlYWRlci5vbmFib3J0ID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmluZm8oJ0ZpbGUgcmVhZCBjYW5jZWxsZWQuJyk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZWFkZXIub25sb2Fkc3RhcnQgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIC8vIFJlc2V0IHByb2dyZXNzIGluZGljYXRvciBvbiBuZXcgZmlsZSBzZWxlY3Rpb25cclxuICAgICAgICAgICAgZGl2UHJvZ3Jlc3Muc3R5bGUud2lkdGggPSAnMCUnO1xyXG4gICAgICAgICAgICBkaXZQcm9ncmVzcy50ZXh0Q29udGVudCA9ICcwJSc7XHJcbiAgICAgICAgICAgIGFkZENsYXNzKGVsUHJvZ3Jlc3NCYXIsICdsb2FkaW5nJyk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZWFkZXIub25sb2FkZW5kID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICAvLyBFbnN1cmUgdGhhdCB0aGUgcHJvZ3Jlc3MgYmFyIGRpc3BsYXlzIDEwMCUgYXQgdGhlIGVuZFxyXG4gICAgICAgICAgICBkaXZQcm9ncmVzcy5zdHlsZS53aWR0aCA9ICcxMDAlJztcclxuICAgICAgICAgICAgZGl2UHJvZ3Jlc3MudGV4dENvbnRlbnQgPSAnMTAwJSc7XHJcbiAgICAgICAgICAgIHNldFRpbWVvdXQoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICByZW1vdmVDbGFzcyhlbFByb2dyZXNzQmFyLCAnbG9hZGluZycpO1xyXG4gICAgICAgICAgICAgICAgcmVtb3ZlQ2xhc3MoYnRuQ2FuY2VsRmlsZSwgJ3Nob3cnKTtcclxuICAgICAgICAgICAgfSwgMjUwKTtcclxuICAgICAgICAgICAgLy9zZXRUaW1lb3V0KGNsb3NlTW9kYWwsIDUwMCk7XHJcbiAgICAgICAgfTtcclxuICAgICAgICByZWFkZXIub25sb2FkID0gZnVuY3Rpb24gKGUpIHtcclxuICAgICAgICAgICAgY3JlYXRlV29ya2VyKCBwYXJzZXIsIGUudGFyZ2V0LnJlc3VsdCwgZmlsZSwgdXBkYXRlRGlzcGxheSApO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIHJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihmaWxlKTtcclxuICAgIH0pO1xyXG4gICAgXHJcbiAgICBidG5DYW5jZWxGaWxlLmFkZEV2ZW50TGlzdGVuZXIoJ2NsaWNrJywgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgaWYgKHJlYWRlcikgcmVhZGVyLmFib3J0KCk7XHJcbiAgICB9KTtcclxuICAgIFxyXG4gICAgZnVuY3Rpb24gdXBkYXRlUHJvZ3Jlc3MoZS8qOlByb2dyZXNzRXZlbnQqLykge1xyXG4gICAgICAgIGlmIChlLmxlbmd0aENvbXB1dGFibGUpIHtcclxuICAgICAgICAgICAgdmFyIHBlcmNlbnRMb2FkZWQgPSBNYXRoLnJvdW5kKChlLmxvYWRlZCAvIGUudG90YWwpICogMTAwKTtcclxuICAgICAgICAgICAgaWYgKHBlcmNlbnRMb2FkZWQgPCAxMDApIHtcclxuICAgICAgICAgICAgICAgIGRpdlByb2dyZXNzLnN0eWxlLndpZHRoID0gcGVyY2VudExvYWRlZCArICclJztcclxuICAgICAgICAgICAgICAgIGRpdlByb2dyZXNzLnRleHRDb250ZW50ID0gcGVyY2VudExvYWRlZCArICclJztcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgZnVuY3Rpb24gZXJyb3JIYW5kbGVyKGUpIHtcclxuICAgICAgICB2YXIgZXJyID0gZS50YXJnZXQuZXJyb3I7XHJcbiAgICAgICAgc3dpdGNoIChlcnIuY29kZSkge1xyXG4gICAgICAgICAgICBjYXNlIGVyci5OT1RfRk9VTkRfRVJSOlxyXG4gICAgICAgICAgICAgICAgY29uc29sZS5lcnJvcignRmlsZSBOb3QgRm91bmQhJyk7XHJcbiAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgY2FzZSBlcnIuTk9UX1JFQURBQkxFX0VSUjpcclxuICAgICAgICAgICAgICAgIGNvbnNvbGUuZXJyb3IoJ0ZpbGUgaXMgbm90IHJlYWRhYmxlIScpO1xyXG4gICAgICAgICAgICAgICAgYnJlYWs7XHJcbiAgICAgICAgICAgIGNhc2UgZXJyLkFCT1JUX0VSUjpcclxuICAgICAgICAgICAgICAgIGJyZWFrOyAvLyBub29wXHJcbiAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmVycm9yKCdBbiBlcnJvciBvY2N1cnJlZCByZWFkaW5nIHRoaXMgZmlsZS48Y29kZT4nICsgZXJyLm1lc3NhZ2UgKyAnPGJyPignICsgZXJyLmZpbGVuYW1lICsgJzonICsgZXJyLmxpbmVubyArICcpPC9jb2RlPicpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIFxyXG4gICAgZnVuY3Rpb24gdXBkYXRlRGlzcGxheShqc29uLCBmaWxlKSB7XHJcbiAgICAgICAgYWxlcnQoJ2RvbmUhJyk7XHJcbiAgICAgICAgY29uc29sZS5sb2coanNvbiwgZmlsZSk7XHJcbiAgICAgICAgXHJcbiAgICAgICAgXHJcbiAgICB9XHJcbiAgICBcclxuICAgIGZ1bmN0aW9uIGNyZWF0ZVdvcmtlciggcGFyc2VyLCBidWZmZXIsIGZpbGUsIG9uQ29tcGxldGUgKSB7XHJcbiAgICAgICAgdmFyIHdvcmtlciA9IG5ldyBXb3JrZXIoJ2pzL3dvcmtlcnMvJyArIHBhcnNlciArICcuanMnKTtcclxuICAgICAgICB3b3JrZXIub25tZXNzYWdlID0gZnVuY3Rpb24oZSkge1xyXG4gICAgICAgICAgICBpZiAoZS5kYXRhLnR5cGUgPT0gJ2RlYnVnJykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGRlYnVnKSBjb25zb2xlLmluZm8oZS5kYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGlmIChlLmRhdGEudHlwZSA9PSAnd2FybmluZycpIHtcclxuICAgICAgICAgICAgICAgIGlmIChkZWJ1ZykgY29uc29sZS53YXJuKGUuZGF0YS5tZXNzYWdlKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpZiAoZS5kYXRhLnR5cGUgPT0gJ2FsZXJ0Jykge1xyXG4gICAgICAgICAgICAgICAgaWYgKGRlYnVnKSBjb25zb2xlLndhcm4oZS5kYXRhLm1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgLy9BbGVydC5zaG93KGUuZGF0YS5tZXNzYWdlLCBBbGVydC5XQVJOSU5HKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgLy92YXIgaWR4ID0gZS5kYXRhLmZpbGVJRDtcclxuICAgICAgICAgICAgdmFyIGRhdGEgPSBlLmRhdGEuZGF0YTtcclxuICAgICAgICAgICAgZGF0YS5maWxlU2l6ZSA9IGZpbGUuc2l6ZTtcclxuICAgICAgICAgICAgZGF0YS5maWxlTmFtZSA9IGZpbGUubmFtZTtcclxuICAgICAgICAgICAgaWYgKGRlYnVnKSBjb25zb2xlLmxvZygnRGF0YScsIGRhdGEpO1xyXG5cclxuICAgICAgICAgICAgdmFyIGpzb24gPSBKU09OLnN0cmluZ2lmeShkYXRhKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIG9uQ29tcGxldGUoanNvbiwgZmlsZSk7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgd29ya2VyLm9uZXJyb3IgPSBmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgY29uc29sZS5lcnJvcignV29ya2VyICcgKyBlcnJvci5tZXNzYWdlICsgJyAgKCcgKyBlcnJvci5maWxlbmFtZSArICc6JyArIGVycm9yLmxpbmVubyArICcpJyk7XHJcbiAgICAgICAgICAgIC8vQWxlcnQuc2hvdygnRXJyb3IgcmVhZGluZyBmaWxlOjxjb2RlPicgKyBlcnJvci5tZXNzYWdlICsgJzxicj4oJyArIGVycm9yLmZpbGVuYW1lICsgJzonICsgZXJyb3IubGluZW5vICsgJyk8L2NvZGU+JywgQWxlcnQuRVJST1IpO1xyXG4gICAgICAgICAgICBvbkNvbXBsZXRlKHt0ZXh0OidFcnJvciByZWFkaW5nIGZpbGUnLCBpY29uOidlcnJvcid9LCBmaWxlKTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICB3b3JrZXIucG9zdE1lc3NhZ2Uoe1xyXG4gICAgICAgICAgICB0ZXh0OiBidWZmZXIsXHJcbiAgICAgICAgICAgIGZpbGVJRDogMFxyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG59KTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3NyYy9tYWluLmpzXG4vLyBtb2R1bGUgaWQgPSAwXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsImNvbnN0ICQgPSAoc2VsZWN0b3JzLCBkb2M9ZG9jdW1lbnQpID0+IHtcclxuICAgIGNvbnN0IHJlc3VsdCA9IGRvYy5xdWVyeVNlbGVjdG9yQWxsKHNlbGVjdG9ycyk7XHJcbiAgICByZXR1cm4gKDEgPT09IHJlc3VsdC5sZW5ndGgpID8gcmVzdWx0WzBdIDogcmVzdWx0O1xyXG59O1xyXG5cclxuY29uc3QgcmVhZHkgPSAoZnVuYywgZG9jPWRvY3VtZW50KSA9PiB7XHJcbiAgICBpZiAoZG9jLnJlYWR5U3RhdGUgIT09ICdsb2FkaW5nJykge1xyXG4gICAgICAgIGZ1bmMoKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgZG9jLmFkZEV2ZW50TGlzdGVuZXIoJ0RPTUNvbnRlbnRMb2FkZWQnLCBmdW5jKTtcclxuICAgIH1cclxufTtcclxuXHJcbmNvbnN0IGZvcm1hdEJ5dGVzID0gKGJ5dGVzPTAsIHByZWNpc2lvblByZWY9MikgPT4ge1xyXG4gICAgaWYgKGJ5dGVzIDw9IDApIHJldHVybiAnMCBCJztcclxuICAgIGlmIChwcmVjaXNpb25QcmVmIDw9IC0xKSByZXR1cm4gYnl0ZXMgKyAnIEInO1xyXG5cclxuICAgIGNvbnN0IHByZWNpc2lvbiA9IE1hdGgubWluKHByZWNpc2lvblByZWYsIDIxKTtcclxuICAgIGNvbnN0IHVuaXRzID0gWydCJywgJ2tCJywgJ01CJywgJ0dCJywgJ1RCJywgJ1BCJ107XHJcbiAgICBjb25zdCBtb2QgPSAxMDI0O1xyXG4gICAgbGV0IGkgPSAwO1xyXG4gICAgd2hpbGUgKGJ5dGVzID4gbW9kKSB7XHJcbiAgICAgICAgYnl0ZXMgLz0gbW9kO1xyXG4gICAgICAgIGkrKztcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gYnl0ZXMudG9QcmVjaXNpb24ocHJlY2lzaW9uKSArICcgJyArIHVuaXRzW2ldO1xyXG59O1xyXG5cclxuLy8gaHR0cHM6Ly9naXRodWIuY29tL3JhZGlvdmlzdWFsL3plcm9wYWRcclxuY29uc3QgemVyb1BhZCA9IChudW1iZXI9MSwgbGVuZ3RoPTIpID0+IHtcclxuICAgIGlmICggaXNOYU4obnVtYmVyKSApIHRocm93IG5ldyBTeW50YXhFcnJvcignemVyb1BhZCByZXF1aXJlcyBhIG51bWJlciBvciBzdHJpbmcnKTtcclxuICAgIGlmICggaXNOYU4obGVuZ3RoKSB8fCBsZW5ndGggPCAwICkgdGhyb3cgbmV3IFN5bnRheEVycm9yKCd6ZXJvUGFkIHJlcXVpcmVzIGEgcG9zaXRpdmUgaW50ZWdlciBmb3IgbGVuZ3RoJyk7XHJcblxyXG4gICAgLy8gaHR0cHM6Ly9naXRodWIuY29tL3NpbmRyZXNvcmh1cy9uZWdhdGl2ZS16ZXJvXHJcbiAgICBjb25zdCBwcmVmaXggPSBPYmplY3QuaXMobnVtYmVyLCAtMCkgfHwgbnVtYmVyIDwgMCA/ICctJyA6ICcnO1xyXG4gICAgbnVtYmVyID0gTWF0aC5hYnMocGFyc2VGbG9hdChudW1iZXIpKTtcclxuICAgIGNvbnN0IHBhZExlbmd0aCA9IChsZW5ndGggLSBTdHJpbmcobnVtYmVyKS5sZW5ndGgpICsgMTtcclxuICAgIGNvbnN0IHBhZHMgPSBuZXcgQXJyYXkocGFkTGVuZ3RoKS5qb2luKCcwJyk7XHJcbiAgICByZXR1cm4gcHJlZml4ICsgcGFkcyArIG51bWJlcjtcclxufTtcclxuXHJcbmNvbnN0IGh0bWxFbnRpdGllcyA9IChzdHIpID0+IHtcclxuICAgIHJldHVybiBTdHJpbmcoc3RyKS5yZXBsYWNlKC8mL2csICcmYW1wOycpLnJlcGxhY2UoLzwvZywgJyZsdDsnKS5yZXBsYWNlKC8+L2csICcmZ3Q7JykucmVwbGFjZSgvXCIvZywgJyZxdW90OycpLnJlcGxhY2UoLycvZywnJmFwb3MnKTtcclxufTtcclxuXHJcbi8qXHJcbi8vIFRoYW5rcyBsb2Rhc2hcclxuY29uc3QgdGhyb3R0bGUgPSAoZnVuYywgd2FpdCwgb3B0aW9ucykgPT4ge1xyXG4gICAgdmFyIGxlYWRpbmcgPSB0cnVlLFxyXG4gICAgICAgIHRyYWlsaW5nID0gdHJ1ZTtcclxuXHJcbiAgICBpZiAoIHR5cGVvZiBmdW5jICE9PSAnZnVuY3Rpb24nICkgdGhyb3cgbmV3IFR5cGVFcnJvcignVmFsdWUgXCJmdW5jXCIgbm90IGEgRnVuY3Rpb24nKTtcclxuICAgIFxyXG4gICAgLy8gaXMgb2JqZWN0XHJcbiAgICBpZiAoISFvcHRpb25zICYmICh0eXBlb2Ygb3B0aW9ucyA9PT0gJ29iamVjdCcgfHwgdHlwZW9mIG9wdGlvbnMgPT09ICdmdW5jdGlvbicpKSB7XHJcbiAgICAgICAgbGVhZGluZyA9ICdsZWFkaW5nJyBpbiBvcHRpb25zID8gISFvcHRpb25zLmxlYWRpbmcgOiB0cnVlO1xyXG4gICAgICAgIHRyYWlsaW5nID0gJ3RyYWlsaW5nJyBpbiBvcHRpb25zID8gISFvcHRpb25zLnRyYWlsaW5nIDogdHJ1ZTtcclxuICAgIH1cclxuICAgIFxyXG4gICAgcmV0dXJuIGRlYm91bmNlKGZ1bmMsIHdhaXQsIHtcclxuICAgICAgICAnbGVhZGluZyc6IGxlYWRpbmcsXHJcbiAgICAgICAgJ21heFdhaXQnOiB3YWl0LFxyXG4gICAgICAgICd0cmFpbGluZyc6IHRyYWlsaW5nXHJcbiAgICB9KTtcclxufTtcclxuXHJcbi8vIFRoYW5rcyBsb2Rhc2hcclxuY29uc3QgZGVib3VuY2UgPSAoZnVuYywgd2FpdCwgb3B0aW9ucykgPT4ge1xyXG4gICAgdmFyIGxhc3RBcmdzLFxyXG4gICAgICAgIGxhc3RUaGlzLFxyXG4gICAgICAgIG1heFdhaXQsXHJcbiAgICAgICAgcmVzdWx0LFxyXG4gICAgICAgIHRpbWVySWQsXHJcbiAgICAgICAgbGFzdENhbGxUaW1lLFxyXG4gICAgICAgIGxhc3RJbnZva2VUaW1lID0gMCxcclxuICAgICAgICBsZWFkaW5nID0gZmFsc2UsXHJcbiAgICAgICAgbWF4aW5nID0gZmFsc2UsXHJcbiAgICAgICAgdHJhaWxpbmcgPSB0cnVlO1xyXG5cclxuICAgIGlmICggdHlwZW9mIGZ1bmMgIT09ICdmdW5jdGlvbicgKSB0aHJvdyBuZXcgVHlwZUVycm9yKCdWYWx1ZSBcImZ1bmNcIiBub3QgYSBGdW5jdGlvbicpO1xyXG4gICAgXHJcbiAgICB3YWl0ID0gcGFyc2VJbnQod2FpdCkgfHwgMDtcclxuICAgIFxyXG4gICAgLy8gaXMgb2JqZWN0XHJcbiAgICBpZiAoICEhb3B0aW9ucyAmJiAodHlwZW9mIG9wdGlvbnMgPT0gJ29iamVjdCcgfHwgdHlwZW9mIG9wdGlvbnMgPT0gJ2Z1bmN0aW9uJykgKSB7XHJcbiAgICAgICAgbGVhZGluZyA9ICEhb3B0aW9ucy5sZWFkaW5nO1xyXG4gICAgICAgIG1heGluZyA9ICdtYXhXYWl0JyBpbiBvcHRpb25zO1xyXG4gICAgICAgIG1heFdhaXQgPSBtYXhpbmcgPyBNYXRoLm1heChwYXJzZUludChvcHRpb25zLm1heFdhaXQpIHx8IDAsIHdhaXQpIDogbWF4V2FpdDtcclxuICAgICAgICB0cmFpbGluZyA9ICd0cmFpbGluZycgaW4gb3B0aW9ucyA/ICEhb3B0aW9ucy50cmFpbGluZyA6IHRyYWlsaW5nO1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGludm9rZUZ1bmModGltZSkge1xyXG4gICAgICAgIHZhciBhcmdzID0gbGFzdEFyZ3MsXHJcbiAgICAgICAgICAgIHRoaXNBcmcgPSBsYXN0VGhpcztcclxuXHJcbiAgICAgICAgbGFzdEFyZ3MgPSBsYXN0VGhpcyA9IHVuZGVmaW5lZDtcclxuICAgICAgICBsYXN0SW52b2tlVGltZSA9IHRpbWU7XHJcbiAgICAgICAgcmVzdWx0ID0gZnVuYy5hcHBseSh0aGlzQXJnLCBhcmdzKTtcclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIGxlYWRpbmdFZGdlKHRpbWUpIHtcclxuICAgICAgICAvLyBSZXNldCBhbnkgYG1heFdhaXRgIHRpbWVyLlxyXG4gICAgICAgIGxhc3RJbnZva2VUaW1lID0gdGltZTtcclxuICAgICAgICAvLyBTdGFydCB0aGUgdGltZXIgZm9yIHRoZSB0cmFpbGluZyBlZGdlLlxyXG4gICAgICAgIHRpbWVySWQgPSBzZXRUaW1lb3V0KHRpbWVyRXhwaXJlZCwgd2FpdCk7XHJcbiAgICAgICAgLy8gSW52b2tlIHRoZSBsZWFkaW5nIGVkZ2UuXHJcbiAgICAgICAgcmV0dXJuIGxlYWRpbmcgPyBpbnZva2VGdW5jKHRpbWUpIDogcmVzdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHJlbWFpbmluZ1dhaXQodGltZSkge1xyXG4gICAgICAgIHZhciB0aW1lU2luY2VMYXN0Q2FsbCA9IHRpbWUgLSBsYXN0Q2FsbFRpbWUsXHJcbiAgICAgICAgICAgIHRpbWVTaW5jZUxhc3RJbnZva2UgPSB0aW1lIC0gbGFzdEludm9rZVRpbWUsXHJcbiAgICAgICAgICAgIHJlc3VsdCA9IHdhaXQgLSB0aW1lU2luY2VMYXN0Q2FsbDtcclxuXHJcbiAgICAgICAgcmV0dXJuIG1heGluZyA/IE1hdGgubWluKHJlc3VsdCwgbWF4V2FpdCAtIHRpbWVTaW5jZUxhc3RJbnZva2UpIDogcmVzdWx0O1xyXG4gICAgfVxyXG5cclxuICAgIGZ1bmN0aW9uIHNob3VsZEludm9rZSh0aW1lKSB7XHJcbiAgICAgICAgdmFyIHRpbWVTaW5jZUxhc3RDYWxsID0gdGltZSAtIGxhc3RDYWxsVGltZSxcclxuICAgICAgICAgICAgdGltZVNpbmNlTGFzdEludm9rZSA9IHRpbWUgLSBsYXN0SW52b2tlVGltZTtcclxuXHJcbiAgICAgICAgLy8gRWl0aGVyIHRoaXMgaXMgdGhlIGZpcnN0IGNhbGwsIGFjdGl2aXR5IGhhcyBzdG9wcGVkIGFuZCB3ZSdyZSBhdCB0aGVcclxuICAgICAgICAvLyB0cmFpbGluZyBlZGdlLCB0aGUgc3lzdGVtIHRpbWUgaGFzIGdvbmUgYmFja3dhcmRzIGFuZCB3ZSdyZSB0cmVhdGluZ1xyXG4gICAgICAgIC8vIGl0IGFzIHRoZSB0cmFpbGluZyBlZGdlLCBvciB3ZSd2ZSBoaXQgdGhlIGBtYXhXYWl0YCBsaW1pdC5cclxuICAgICAgICByZXR1cm4gKGxhc3RDYWxsVGltZSA9PT0gdW5kZWZpbmVkIHx8ICh0aW1lU2luY2VMYXN0Q2FsbCA+PSB3YWl0KSB8fFxyXG4gICAgICAgICh0aW1lU2luY2VMYXN0Q2FsbCA8IDApIHx8IChtYXhpbmcgJiYgdGltZVNpbmNlTGFzdEludm9rZSA+PSBtYXhXYWl0KSk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gdGltZXJFeHBpcmVkKCkge1xyXG4gICAgICAgIHZhciB0aW1lID0gRGF0ZS5ub3coKTtcclxuICAgICAgICBpZiAoc2hvdWxkSW52b2tlKHRpbWUpKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB0cmFpbGluZ0VkZ2UodGltZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIC8vIFJlc3RhcnQgdGhlIHRpbWVyLlxyXG4gICAgICAgIHRpbWVySWQgPSBzZXRUaW1lb3V0KHRpbWVyRXhwaXJlZCwgcmVtYWluaW5nV2FpdCh0aW1lKSk7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gdHJhaWxpbmdFZGdlKHRpbWUpIHtcclxuICAgICAgICB0aW1lcklkID0gdW5kZWZpbmVkO1xyXG5cclxuICAgICAgICAvLyBPbmx5IGludm9rZSBpZiB3ZSBoYXZlIGBsYXN0QXJnc2Agd2hpY2ggbWVhbnMgYGZ1bmNgIGhhcyBiZWVuXHJcbiAgICAgICAgLy8gZGVib3VuY2VkIGF0IGxlYXN0IG9uY2UuXHJcbiAgICAgICAgaWYgKHRyYWlsaW5nICYmIGxhc3RBcmdzKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBpbnZva2VGdW5jKHRpbWUpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsYXN0QXJncyA9IGxhc3RUaGlzID0gdW5kZWZpbmVkO1xyXG4gICAgICAgIHJldHVybiByZXN1bHQ7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gY2FuY2VsKCkge1xyXG4gICAgICAgIGlmICh0aW1lcklkICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgY2xlYXJUaW1lb3V0KHRpbWVySWQpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsYXN0SW52b2tlVGltZSA9IDA7XHJcbiAgICAgICAgbGFzdEFyZ3MgPSBsYXN0Q2FsbFRpbWUgPSBsYXN0VGhpcyA9IHRpbWVySWQgPSB1bmRlZmluZWQ7XHJcbiAgICB9XHJcblxyXG4gICAgZnVuY3Rpb24gZmx1c2goKSB7XHJcbiAgICAgICAgcmV0dXJuIHRpbWVySWQgPT09IHVuZGVmaW5lZCA/IHJlc3VsdCA6IHRyYWlsaW5nRWRnZShEYXRlLm5vdygpKTtcclxuICAgIH1cclxuXHJcbiAgICBmdW5jdGlvbiBkZWJvdW5jZWQoKSB7XHJcbiAgICAgICAgdmFyIHRpbWUgPSBEYXRlLm5vdygpLFxyXG4gICAgICAgICAgICBpc0ludm9raW5nID0gc2hvdWxkSW52b2tlKHRpbWUpO1xyXG5cclxuICAgICAgICBsYXN0QXJncyA9IGFyZ3VtZW50cztcclxuICAgICAgICBsYXN0VGhpcyA9IHRoaXM7XHJcbiAgICAgICAgbGFzdENhbGxUaW1lID0gdGltZTtcclxuXHJcbiAgICAgICAgaWYgKGlzSW52b2tpbmcpIHtcclxuICAgICAgICAgICAgaWYgKHRpbWVySWQgPT09IHVuZGVmaW5lZCkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGxlYWRpbmdFZGdlKGxhc3RDYWxsVGltZSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKG1heGluZykge1xyXG4gICAgICAgICAgICAgICAgLy8gSGFuZGxlIGludm9jYXRpb25zIGluIGEgdGlnaHQgbG9vcC5cclxuICAgICAgICAgICAgICAgIHRpbWVySWQgPSBzZXRUaW1lb3V0KHRpbWVyRXhwaXJlZCwgd2FpdCk7XHJcbiAgICAgICAgICAgICAgICByZXR1cm4gaW52b2tlRnVuYyhsYXN0Q2FsbFRpbWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICh0aW1lcklkID09PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgdGltZXJJZCA9IHNldFRpbWVvdXQodGltZXJFeHBpcmVkLCB3YWl0KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuICAgIFxyXG4gICAgZGVib3VuY2VkLmNhbmNlbCA9IGNhbmNlbDtcclxuICAgIGRlYm91bmNlZC5mbHVzaCA9IGZsdXNoO1xyXG4gICAgcmV0dXJuIGRlYm91bmNlZDtcclxufTsqL1xyXG5cclxuZXhwb3J0IHtcclxuICAgICQsXHJcbiAgICByZWFkeSxcclxuICAgIGZvcm1hdEJ5dGVzLFxyXG4gICAgaHRtbEVudGl0aWVzLFxyXG4gICAgemVyb1BhZFxyXG4gICAgLy90aHJvdHRsZSxcclxuICAgIC8vZGVib3VuY2VcclxufTtcblxuXG4vLy8vLy8vLy8vLy8vLy8vLy9cbi8vIFdFQlBBQ0sgRk9PVEVSXG4vLyAuL3NyYy9qcy9tb2R1bGVzL3Rvb2xib3gtY29tbW9uLmpzXG4vLyBtb2R1bGUgaWQgPSAxXG4vLyBtb2R1bGUgY2h1bmtzID0gMCIsImNvbnN0IGNzcyA9IChlbCwgcHJvcCwgdmFsID0gbnVsbCkgPT4ge1xyXG4gICAgLy8gU2V0XHJcbiAgICBpZiAodmFsICE9PSBudWxsKSB7XHJcbiAgICAgICAgZWwuc3R5bGVbcHJvcF0gPSB2YWw7XHJcbiAgICAgICAgcmV0dXJuIGVsO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEdldFxyXG4gICAgY29uc3QgdmlldyA9IGVsLm93bmVyRG9jdW1lbnQuZGVmYXVsdFZpZXcgfHwgd2luZG93O1xyXG4gICAgY29uc3QgY29tcHV0ZWQgPSB2aWV3LmdldENvbXB1dGVkU3R5bGUoZWwpO1xyXG4gICAgcmV0dXJuIGNvbXB1dGVkLmdldFByb3BlcnR5VmFsdWUocHJvcCkgfHwgY29tcHV0ZWRbcHJvcF07XHJcbn07XHJcblxyXG4vLyBpbm5lcldpZHRoIC8gaW5uZXJIZWlnaHQgLSBpbmNsdWRlcyBwYWRkaW5nIGJ1dCBub3QgYm9yZGVyXHJcbmNvbnN0IGdldElubmVyV2lkdGggPSAoZWwpID0+IHtcclxuICAgIHJldHVybiAoZWwgIT09IG51bGwgJiYgZWwgPT09IGVsLndpbmRvdykgPyBlbC5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50V2lkdGggOiBlbC5jbGllbnRXaWR0aDtcclxufTtcclxuXHJcbmNvbnN0IGdldElubmVySGVpZ2h0ID0gKGVsKSA9PiB7XHJcbiAgICByZXR1cm4gKGVsICE9PSBudWxsICYmIGVsID09PSBlbC53aW5kb3cpID8gZWwuZG9jdW1lbnQuZG9jdW1lbnRFbGVtZW50LmNsaWVudEhlaWdodCA6IGVsLmNsaWVudEhlaWdodDtcclxufTtcclxuXHJcbi8vIG91dGVyV2lkdGggLyBvdXRlckhlaWdodCAtIGluY2x1ZGVzIHBhZGRpbmcsIGJvcmRlciwgYW5kIG9wdGlvbmFsbHkgbWFyZ2luXHJcbmNvbnN0IGdldE91dGVyV2lkdGggPSAoZWwpID0+IHtcclxuICAgIC8vICQoIHdpbmRvdyApLm91dGVyV2lkdGgvSGVpZ2h0IHJldHVybiB3L2ggaW5jbHVkaW5nIHNjcm9sbGJhcnMgKGdoLTE3MjkpXHJcbiAgICByZXR1cm4gKGVsICE9PSBudWxsICYmIGVsID09PSBlbC53aW5kb3cpID8gZWwuaW5uZXJXaWR0aCA6IGVsLm9mZnNldFdpZHRoO1xyXG59O1xyXG5cclxuY29uc3QgZ2V0T3V0ZXJIZWlnaHQgPSAoZWwpID0+IHtcclxuICAgIC8vICQoIHdpbmRvdyApLm91dGVyV2lkdGgvSGVpZ2h0IHJldHVybiB3L2ggaW5jbHVkaW5nIHNjcm9sbGJhcnMgKGdoLTE3MjkpXHJcbiAgICByZXR1cm4gKGVsICE9PSBudWxsICYmIGVsID09PSBlbC53aW5kb3cpID8gZWwuaW5uZXJIZWlnaHQgOiBlbC5vZmZzZXRIZWlnaHQ7XHJcbn07XHJcblxyXG4vLyBoZWlnaHQgLyB3aWR0aCAtIGVsZW1lbnQgaGVpZ2h0IChubyBwYWRkaW5nLCBtYXJnaW4sIG9yIGJvcmRlcilcclxuLy8gaHR0cDovL2NvZGVibG9nLmN6L3ZhbmlsbGEvc3R5bGUuaHRtbFxyXG4vLyB2YWx1ZSBpcyBpbnRcclxuY29uc3Qgd2lkdGggPSAoZWwsIHZhbHVlID0gbnVsbCkgPT4ge1xyXG4gICAgLy8gR2V0IHdpbmRvdyB3aWR0aFxyXG4gICAgaWYgKCBlbCAhPT0gbnVsbCAmJiBlbCA9PT0gZWwud2luZG93ICkgcmV0dXJuIGVsLmRvY3VtZW50LmRvY3VtZW50RWxlbWVudC5jbGllbnRXaWR0aDtcclxuXHJcbiAgICAvLyBHZXQgZG9jdW1lbnQgd2lkdGhcclxuICAgIGlmICg5ID09PSBlbC5ub2RlVHlwZSkge1xyXG4gICAgICAgIGNvbnN0IGRvYyA9IGVsLmRvY3VtZW50RWxlbWVudDtcclxuICAgICAgICAvLyBFaXRoZXIgc2Nyb2xsW1dpZHRoL0hlaWdodF0gb3Igb2Zmc2V0W1dpZHRoL0hlaWdodF0gb3IgY2xpZW50W1dpZHRoL0hlaWdodF0sXHJcbiAgICAgICAgLy8gd2hpY2hldmVyIGlzIGdyZWF0ZXN0XHJcbiAgICAgICAgcmV0dXJuIE1hdGgubWF4KFxyXG4gICAgICAgICAgICBlbC5ib2R5LnNjcm9sbFdpZHRoLCBkb2Muc2Nyb2xsV2lkdGgsXHJcbiAgICAgICAgICAgIGVsLmJvZHkub2Zmc2V0V2lkdGgsIGRvYy5vZmZzZXRXaWR0aCxcclxuICAgICAgICAgICAgZG9jLmNsaWVudFdpZHRoXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICAvLyBFbGVtZW50XHJcbiAgICBpZiAobnVsbCA9PT0gdmFsdWUpIHtcclxuICAgICAgICAvLyBHZXRcclxuICAgICAgICByZXR1cm4gcGFyc2VJbnQoIGNzcyhlbCwgJ3dpZHRoJykgKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gU2V0XHJcbiAgICAgICAgY3NzKGVsLCAnd2lkdGgnLCBwYXJzZUludCh2YWx1ZSkgKyAncHgnKTtcclxuICAgICAgICByZXR1cm4gZWw7XHJcbiAgICB9XHJcbn07XHJcblxyXG5jb25zdCBoZWlnaHQgPSAoZWwsIHZhbHVlID0gbnVsbCkgPT4ge1xyXG4gICAgLy8gR2V0IHdpbmRvdyB3aWR0aFxyXG4gICAgaWYgKGVsICE9PSBudWxsICYmIGVsID09PSBlbC53aW5kb3cpIHJldHVybiBlbC5kb2N1bWVudC5kb2N1bWVudEVsZW1lbnQuY2xpZW50SGVpZ2h0O1xyXG5cclxuICAgIC8vIEdldCBkb2N1bWVudCB3aWR0aFxyXG4gICAgaWYgKDkgPT09IGVsLm5vZGVUeXBlKSB7XHJcbiAgICAgICAgdmFyIGRvYyA9IGVsLmRvY3VtZW50RWxlbWVudDtcclxuICAgICAgICAvLyBFaXRoZXIgc2Nyb2xsW1dpZHRoL0hlaWdodF0gb3Igb2Zmc2V0W1dpZHRoL0hlaWdodF0gb3IgY2xpZW50W1dpZHRoL0hlaWdodF0sXHJcbiAgICAgICAgLy8gd2hpY2hldmVyIGlzIGdyZWF0ZXN0XHJcbiAgICAgICAgcmV0dXJuIE1hdGgubWF4KFxyXG4gICAgICAgICAgICBlbC5ib2R5LnNjcm9sbEhlaWdodCwgZG9jLnNjcm9sbEhlaWdodCxcclxuICAgICAgICAgICAgZWwuYm9keS5vZmZzZXRIZWlnaHQsIGRvYy5vZmZzZXRIZWlnaHQsXHJcbiAgICAgICAgICAgIGRvYy5jbGllbnRIZWlnaHRcclxuICAgICAgICApO1xyXG4gICAgfVxyXG5cclxuICAgIC8vIEVsZW1lbnRcclxuICAgIGlmIChudWxsID09PSB2YWx1ZSkge1xyXG4gICAgICAgIC8vIEdldFxyXG4gICAgICAgIHJldHVybiBwYXJzZUludCggY3NzKGVsLCAnaGVpZ2h0JykgKTtcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgICAgLy8gU2V0XHJcbiAgICAgICAgY3NzKGVsLCAnaGVpZ2h0JywgcGFyc2VJbnQodmFsdWUpICsgJ3B4Jyk7XHJcbiAgICAgICAgcmV0dXJuIGVsO1xyXG4gICAgfVxyXG59O1xyXG5cclxuY29uc3QgaGFzQ2xhc3MgPSAoZWwsIHN0ckNsYXNzKSA9PiB7XHJcbiAgICByZXR1cm4gZWwuY2xhc3NMaXN0ID8gZWwuY2xhc3NMaXN0LmNvbnRhaW5zKHN0ckNsYXNzKSA6IG5ldyBSZWdFeHAoJyhefCApJyArIHN0ckNsYXNzICsgJyggfCQpJywgJ2dpJykudGVzdChlbC5jbGFzc05hbWUpO1xyXG59O1xyXG5cclxuY29uc3QgYWRkQ2xhc3MgPSAoZWwsIHN0ckNsYXNzKSA9PiB7XHJcbiAgICBpZiAoZWwuY2xhc3NMaXN0KSB7XHJcbiAgICAgICAgZWwuY2xhc3NMaXN0LmFkZChzdHJDbGFzcyk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGVsLmNsYXNzTmFtZSArPSAnICcgKyBzdHJDbGFzcztcclxuICAgIH1cclxuICAgIHJldHVybiBlbDtcclxufTtcclxuXHJcbmNvbnN0IHJlbW92ZUNsYXNzID0gKGVsLCBzdHJDbGFzcykgPT4ge1xyXG4gICAgaWYgKGVsLmNsYXNzTGlzdCkge1xyXG4gICAgICAgIGVsLmNsYXNzTGlzdC5yZW1vdmUoIHN0ckNsYXNzICk7XHJcbiAgICB9IGVsc2Uge1xyXG4gICAgICAgIGVsLmNsYXNzTmFtZSA9IGVsLmNsYXNzTmFtZS5yZXBsYWNlKCBuZXcgUmVnRXhwKCcoXnxcXFxcYiknICsgc3RyQ2xhc3Muc3BsaXQoJyAnKS5qb2luKCd8JykgKyAnKFxcXFxifCQpJywgJ2dpJyksICcgJyApO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIGVsO1xyXG59O1xyXG5cclxuZXhwb3J0IHtcclxuICAgIGNzcyxcclxuICAgIGdldElubmVyV2lkdGgsXHJcbiAgICBnZXRJbm5lckhlaWdodCxcclxuICAgIGdldE91dGVyV2lkdGgsXHJcbiAgICBnZXRPdXRlckhlaWdodCxcclxuICAgIHdpZHRoLFxyXG4gICAgaGVpZ2h0LFxyXG4gICAgaGFzQ2xhc3MsXHJcbiAgICBhZGRDbGFzcyxcclxuICAgIHJlbW92ZUNsYXNzXHJcbn07XG5cblxuLy8vLy8vLy8vLy8vLy8vLy8vXG4vLyBXRUJQQUNLIEZPT1RFUlxuLy8gLi9zcmMvanMvbW9kdWxlcy90b29sYm94LWNzcy5qc1xuLy8gbW9kdWxlIGlkID0gMlxuLy8gbW9kdWxlIGNodW5rcyA9IDAiXSwic291cmNlUm9vdCI6IiJ9